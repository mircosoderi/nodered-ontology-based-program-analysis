{
  "@context": {
    "schema": "https://schema.org/",
    "nrua": "https://w3id.org/nodered-static-program-analysis/user-application-ontology#"
  },
  "@id": "urn:graph:rules",
  "@graph": [
    {
      "@id": "urn:rule:node-type-title-seeAlso",
      "@type": ["nrua:Rule"],
      "schema:name": "Node type appears in document title => schema:seeAlso (context-aware, issues+forum)",
      "schema:description": "If a node's nrua:type literal occurs in a document title (issues or forum), assert schema:seeAlso(node, doc) in the inferred graph. If the document declares schema:about constraints (OS / Node.js / Node-RED), only match when each declared target-type has at least one constraint that matches the environment (OR within type, AND across types).",
      "schema:programmingLanguage": "SPARQL",
      "schema:encodingFormat": "application/sparql-query",
      "schema:text": "SELECT DISTINCT ?s ?p ?o WHERE {\n  GRAPH <urn:nrua:app> {\n    ?s <https://w3id.org/nodered-static-program-analysis/user-application-ontology#type> ?t .\n  }\n\n  # Candidate documents from either issues or forum\n  {\n    GRAPH <urn:graph:issues> {\n      ?o a <https://schema.org/DigitalDocument> ;\n         <https://schema.org/title> ?title .\n    }\n  }\n  UNION\n  {\n    GRAPH <urn:graph:forum> {\n      ?o a <https://schema.org/DigitalDocument> ;\n         <https://schema.org/title> ?title .\n    }\n  }\n\n  # Environment facts\n  GRAPH <urn:nrua:env> {\n    ?nodejsEnv a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n               <https://schema.org/version> ?nodejsVerEnv ;\n               <https://schema.org/operatingSystem> ?osEnv .\n\n    ?osEnv a <https://schema.org/OperatingSystem> ;\n           <https://schema.org/name> ?osNameEnv .\n\n    ?noderedEnv a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                <https://schema.org/version> ?noderedVerEnv .\n  }\n\n  # Base match\n  FILTER(CONTAINS(LCASE(STR(?title)), LCASE(STR(?t))))\n\n  # ------------------------------------------------------------\n  # Context gating (issues+forum, OR within same target type)\n  # ------------------------------------------------------------\n\n  # OS: reject only if there is at least one OS constraint AND none matches env\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutOsAny .\n        ?aboutOsAny a <https://schema.org/OperatingSystem> ;\n                    <https://schema.org/name> ?osNameAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutOsAny .\n        ?aboutOsAny a <https://schema.org/OperatingSystem> ;\n                    <https://schema.org/name> ?osNameAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutOsMatch .\n          ?aboutOsMatch a <https://schema.org/OperatingSystem> ;\n                        <https://schema.org/name> ?osNameNeed .\n          FILTER(LCASE(STR(?osNameNeed)) = LCASE(STR(?osNameEnv)))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutOsMatch .\n          ?aboutOsMatch a <https://schema.org/OperatingSystem> ;\n                        <https://schema.org/name> ?osNameNeed .\n          FILTER(LCASE(STR(?osNameNeed)) = LCASE(STR(?osNameEnv)))\n        }\n      }\n    }\n  }\n\n  # Node.js: reject only if there is at least one NodeJs version constraint AND none matches env (soft substring)\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutNodejsAny .\n        ?aboutNodejsAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                        <https://schema.org/version> ?nodejsVerAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutNodejsAny .\n        ?aboutNodejsAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                        <https://schema.org/version> ?nodejsVerAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutNodejsMatch .\n          ?aboutNodejsMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                            <https://schema.org/version> ?nodejsVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?nodejsVerEnv)), LCASE(STR(?nodejsVerNeed))))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutNodejsMatch .\n          ?aboutNodejsMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                            <https://schema.org/version> ?nodejsVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?nodejsVerEnv)), LCASE(STR(?nodejsVerNeed))))\n        }\n      }\n    }\n  }\n\n  # Node-RED: reject only if there is at least one NodeRed version constraint AND none matches env (soft substring)\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutNoderedAny .\n        ?aboutNoderedAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                         <https://schema.org/version> ?noderedVerAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutNoderedAny .\n        ?aboutNoderedAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                         <https://schema.org/version> ?noderedVerAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutNoderedMatch .\n          ?aboutNoderedMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                             <https://schema.org/version> ?noderedVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?noderedVerEnv)), LCASE(STR(?noderedVerNeed))))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutNoderedMatch .\n          ?aboutNoderedMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                             <https://schema.org/version> ?noderedVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?noderedVerEnv)), LCASE(STR(?noderedVerNeed))))\n        }\n      }\n    }\n  }\n\n  BIND(<https://schema.org/seeAlso> AS ?p)\n}\n"
    }
  ]
}

