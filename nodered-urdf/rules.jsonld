{
  "@context": {
    "schema": "https://schema.org/",
    "nrua": "https://w3id.org/nodered-static-program-analysis/user-application-ontology#"
  },
  "@id": "urn:graph:rules",
  "@graph": [
    {
      "@id": "urn:rule:node-type-title-seeAlso",
      "@type": ["nrua:Rule"],
      "schema:name": "Node type appears in document title => schema:seeAlso (context-aware, issues+forum)",
      "schema:description": "If a node's nrua:type literal occurs in a document title (issues or forum), assert schema:seeAlso(node, doc) in the inferred graph. If the document declares schema:about constraints (OS / Node.js / Node-RED), only match when each declared target-type has at least one constraint that matches the environment (OR within type, AND across types).",
      "schema:programmingLanguage": "SPARQL",
      "schema:encodingFormat": "application/sparql-query",
      "schema:text": "SELECT DISTINCT ?s ?p ?o WHERE {\n  GRAPH <urn:nrua:app> {\n    ?s <https://w3id.org/nodered-static-program-analysis/user-application-ontology#type> ?t .\n  }\n\n  # Candidate documents from either issues or forum\n  {\n    GRAPH <urn:graph:issues> {\n      ?o a <https://schema.org/DigitalDocument> ;\n         <https://schema.org/title> ?title .\n    }\n  }\n  UNION\n  {\n    GRAPH <urn:graph:forum> {\n      ?o a <https://schema.org/DigitalDocument> ;\n         <https://schema.org/title> ?title .\n    }\n  }\n\n  # Environment facts\n  GRAPH <urn:nrua:env> {\n    ?nodejsEnv a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n               <https://schema.org/version> ?nodejsVerEnv ;\n               <https://schema.org/operatingSystem> ?osEnv .\n\n    ?osEnv a <https://schema.org/OperatingSystem> ;\n           <https://schema.org/name> ?osNameEnv .\n\n    ?noderedEnv a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                <https://schema.org/version> ?noderedVerEnv .\n  }\n\n  # Base match\n  FILTER(CONTAINS(LCASE(STR(?title)), LCASE(STR(?t))))\n\n  # ------------------------------------------------------------\n  # Context gating (issues+forum, OR within same target type)\n  # ------------------------------------------------------------\n\n  # OS: reject only if there is at least one OS constraint AND none matches env\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutOsAny .\n        ?aboutOsAny a <https://schema.org/OperatingSystem> ;\n                    <https://schema.org/name> ?osNameAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutOsAny .\n        ?aboutOsAny a <https://schema.org/OperatingSystem> ;\n                    <https://schema.org/name> ?osNameAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutOsMatch .\n          ?aboutOsMatch a <https://schema.org/OperatingSystem> ;\n                        <https://schema.org/name> ?osNameNeed .\n          FILTER(LCASE(STR(?osNameNeed)) = LCASE(STR(?osNameEnv)))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutOsMatch .\n          ?aboutOsMatch a <https://schema.org/OperatingSystem> ;\n                        <https://schema.org/name> ?osNameNeed .\n          FILTER(LCASE(STR(?osNameNeed)) = LCASE(STR(?osNameEnv)))\n        }\n      }\n    }\n  }\n\n  # Node.js: reject only if there is at least one NodeJs version constraint AND none matches env (soft substring)\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutNodejsAny .\n        ?aboutNodejsAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                        <https://schema.org/version> ?nodejsVerAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutNodejsAny .\n        ?aboutNodejsAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                        <https://schema.org/version> ?nodejsVerAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutNodejsMatch .\n          ?aboutNodejsMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                            <https://schema.org/version> ?nodejsVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?nodejsVerEnv)), LCASE(STR(?nodejsVerNeed))))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutNodejsMatch .\n          ?aboutNodejsMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeJs> ;\n                            <https://schema.org/version> ?nodejsVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?nodejsVerEnv)), LCASE(STR(?nodejsVerNeed))))\n        }\n      }\n    }\n  }\n\n  # Node-RED: reject only if there is at least one NodeRed version constraint AND none matches env (soft substring)\n  FILTER NOT EXISTS {\n    {\n      GRAPH <urn:graph:issues> {\n        ?o <https://schema.org/about> ?aboutNoderedAny .\n        ?aboutNoderedAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                         <https://schema.org/version> ?noderedVerAny .\n      }\n    }\n    UNION\n    {\n      GRAPH <urn:graph:forum> {\n        ?o <https://schema.org/about> ?aboutNoderedAny .\n        ?aboutNoderedAny a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                         <https://schema.org/version> ?noderedVerAny .\n      }\n    }\n\n    FILTER NOT EXISTS {\n      {\n        GRAPH <urn:graph:issues> {\n          ?o <https://schema.org/about> ?aboutNoderedMatch .\n          ?aboutNoderedMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                             <https://schema.org/version> ?noderedVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?noderedVerEnv)), LCASE(STR(?noderedVerNeed))))\n        }\n      }\n      UNION\n      {\n        GRAPH <urn:graph:forum> {\n          ?o <https://schema.org/about> ?aboutNoderedMatch .\n          ?aboutNoderedMatch a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#NodeRed> ;\n                             <https://schema.org/version> ?noderedVerNeed .\n          FILTER(CONTAINS(LCASE(STR(?noderedVerEnv)), LCASE(STR(?noderedVerNeed))))\n        }\n      }\n    }\n  }\n\n  BIND(<https://schema.org/seeAlso> AS ?p)\n}\n"
    },
    {
      "@id": "urn:rule:appflow-cookbookflow-keywords-perfect-overlap-seeAlso",
      "@type": ["nrua:Rule"],
      "schema:name": "Perfect keyword overlap (app Flow â†” cookbook SoftwareSourceCode) => schema:seeAlso",
      "schema:description": "Link an app Flow to a cookbook SoftwareSourceCode iff their schema:keywords strings are exactly identical (canonical, sorted, comma-separated signature).",
      "schema:programmingLanguage": "SPARQL",
      "schema:encodingFormat": "application/sparql-query",
      "schema:text": "PREFIX schema: <https://schema.org/>\nPREFIX nrua:   <https://w3id.org/nodered-static-program-analysis/user-application-ontology#>\n\nSELECT DISTINCT ?s ?p ?o\nWHERE {\n  GRAPH <urn:nrua:app> {\n    ?s a nrua:Flow ;\n       schema:keywords ?kwSig .\n  }\n  GRAPH <urn:graph:flowslib> {\n    ?o a schema:SoftwareSourceCode ;\n       schema:keywords ?kwSig .\n  }\n\n  BIND(<https://schema.org/seeAlso> AS ?p)\n}\n"
    },
{
  "@id": "urn:rule:anyresource-same-schema-name-sameAs",
  "@type": ["nrua:Rule"],
  "schema:name": "Same schema:name (any resources) => schema:sameAs",
  "schema:description": "If any two distinct resources (of any type) have an identical schema:name literal, assert schema:sameAs between them. Emits only one direction per pair to reduce duplicates.",
  "schema:programmingLanguage": "SPARQL",
  "schema:encodingFormat": "application/sparql-query",
"schema:text": "SELECT DISTINCT ?s ?p ?o\nWHERE {\n  GRAPH <urn:nrua:app> {\n    ?s <https://schema.org/name> ?name .\n    ?o <https://schema.org/name> ?name .\n\n    ?s a ?sClass .\n    ?o a ?oClass .\n\n    VALUES ?sClass {\n      <https://w3id.org/nodered-static-program-analysis/user-application-ontology#Node>\n      <https://w3id.org/nodered-static-program-analysis/user-application-ontology#Flow>\n    }\n    VALUES ?oClass {\n      <https://w3id.org/nodered-static-program-analysis/user-application-ontology#Node>\n      <https://w3id.org/nodered-static-program-analysis/user-application-ontology#Flow>\n    }\n\n    FILTER(?s != ?o)\n  }\n  BIND(<https://schema.org/sameAs> AS ?p)\n}"

},
{
  "@id": "urn:rule:flow-loop-warning-nodes-only",
  "@type": ["nrua:Rule"],
  "schema:name": "Detect loops in app flow (Node/NodeOutput wiring) => schema:comment warning (Nodes only)",
  "schema:description": "Projects only Nodes, NodeOutputs, and wiring (hasOutput/toNode), derives Node->Node edges, computes reachability, detects cycles, and emits schema:comment \"This element is part of a loop.\" only for nrua:Node resources involved in a loop. NodeOutput resources are used only to derive edges and loop membership. Internal helper predicates (urn:nrua:pv:path, urn:nrua:pv:inLoop) should be filtered out at materialization time.",
  "schema:programmingLanguage": "N3",
  "schema:encodingFormat": "text/n3",
  "schema:text": "@prefix schema: <https://schema.org/> .\n\n# Reachability base\n{ ?a <urn:nrua:pv:edge> ?b } => { ?a <urn:nrua:pv:path> ?b } .\n\n# Reachability transitive closure\n{ ?a <urn:nrua:pv:path> ?b . ?b <urn:nrua:pv:edge> ?c } => { ?a <urn:nrua:pv:path> ?c } .\n\n# Node is in a loop if it can reach itself\n{ ?n <urn:nrua:pv:path> ?n } => { ?n <urn:nrua:pv:inLoop> \"true\" } .\n\n# Warn Nodes in loops (Nodes only)\n{ ?n a <https://w3id.org/nodered-static-program-analysis/user-application-ontology#Node> . ?n <urn:nrua:pv:inLoop> \"true\" }\n  => { ?n schema:comment \"This element is part of a loop.\" } .\n",
  "schema:hasPart": [
    {
      "@type": "schema:SoftwareSourceCode",
      "schema:programmingLanguage": "SPARQL",
      "schema:encodingFormat": "application/sparql-query",
      "schema:text": "PREFIX nrua: <https://w3id.org/nodered-static-program-analysis/user-application-ontology#>\n\nSELECT ?s ?p ?o\nWHERE {\n  GRAPH <urn:nrua:app> {\n    # Keep types for Node and NodeOutput\n    { ?s a nrua:Node       BIND(<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> AS ?p) BIND(nrua:Node AS ?o) }\n    UNION\n    { ?s a nrua:NodeOutput BIND(<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> AS ?p) BIND(nrua:NodeOutput AS ?o) }\n\n    # Keep the wiring predicates\n    UNION\n    { ?s nrua:hasOutput ?o BIND(nrua:hasOutput AS ?p) }\n    UNION\n    { ?s nrua:toNode ?o    BIND(nrua:toNode AS ?p) }\n\n    # Helper: Node -> Node edges (for reachability)\n    UNION\n    {\n      ?n nrua:hasOutput ?out .\n      ?out nrua:toNode ?m .\n      BIND(?n AS ?s)\n      BIND(<urn:nrua:pv:edge> AS ?p)\n      BIND(?m AS ?o)\n    }\n  }\n}\n"
    }]},
{
  "@id": "urn:rule:function-node-missing-output-warning",
  "@type": ["nrua:Rule"],
  "schema:name": "Function node with no outputs => schema:comment warning",
  "schema:description": "If a nrua:Node has nrua:type literal \"function\" and has no nrua:hasOutput links to any nrua:NodeOutput, emit a schema:comment warning on that node.",
  "schema:programmingLanguage": "N3",
  "schema:encodingFormat": "text/n3",
  "schema:text": "@prefix schema: <https://schema.org/> .\n\n{ ?n <urn:nrua:pv:functionMissingOutput> \"true\" }\n=>\n{ ?n schema:comment \"There may be a link missing in output from this function node.\" } .\n",
  "schema:hasPart": [
    {
      "@type": "schema:SoftwareSourceCode",
      "schema:programmingLanguage": "SPARQL",
      "schema:encodingFormat": "application/sparql-query",
      "schema:text": "PREFIX rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX schema: <https://schema.org/>\nPREFIX nrua: <https://w3id.org/nodered-static-program-analysis/user-application-ontology#>\n\nSELECT ?s ?p ?o\nWHERE {\n  GRAPH <urn:nrua:app> {\n    ?n rdf:type nrua:Node .\n    ?n nrua:type \"function\" .\n\n    FILTER NOT EXISTS { ?n nrua:hasOutput ?out }\n\n    BIND(?n AS ?s)\n    BIND(<urn:nrua:pv:functionMissingOutput> AS ?p)\n    BIND(\"true\" AS ?o)\n  }\n}\n"
    }
  ]
}



  ]
}

