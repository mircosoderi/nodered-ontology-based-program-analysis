openapi: 3.1.1
info:
  title: Node-RED uRDF Plugin API
  version: 0.0.1
  summary: REST API exposed by node-red-urdf-plugin (runtime/index.js)
  description: 'This OpenAPI spec describes the HTTP Admin endpoints implemented by the Node-RED uRDF runtime plugin.


    Notes:

    - All endpoints are registered under Node-RED''s **Admin HTTP server** (RED.httpAdmin).

    - Responses generally include `{ ok, ts, ... }`, where `ts` is a Unix epoch timestamp in milliseconds.

    - The plugin also publishes push events to the Node-RED editor via `RED.comms.publish("urdf/events", ...)` (not an HTTP API).

    - The backing RDF store is uRDF''s in-memory singleton (within the `urdf` module).

    '
servers:
- url: http://127.0.0.1:1880
  description: Default local Node-RED runtime (example)
tags:
- name: urdf
  description: uRDF store management and query endpoints
- name: rules
  description: Rule management endpoints (stored in a named graph)
components:
  parameters:
    GidQueryOptional:
      name: gid
      in: query
      required: false
      schema:
        type: string
      description: Named graph identifier (gid). If omitted, the endpoint uses the default graph or full store depending on the route.
    GidQueryRequired:
      name: gid
      in: query
      required: true
      schema:
        type: string
      description: Named graph identifier (gid).
    IdQueryRequired:
      name: id
      in: query
      required: true
      schema:
        type: string
      description: Resource identifier (typically an IRI/URN used as `@id`).
  schemas:
    UnixMillis:
      type: integer
      description: Unix epoch timestamp in milliseconds.
      examples:
      - 1737535802000
    OkFlag:
      type: boolean
      description: Whether the operation succeeded.
    ErrorResponse:
      type: object
      required:
      - ok
      - ts
      - error
      properties:
        ok:
          type: boolean
          const: false
        ts:
          $ref: '#/components/schemas/UnixMillis'
        error:
          type: string
    BasicOk:
      type: object
      required:
      - ok
      - ts
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
    HealthOk:
      type: object
      required:
      - ok
      - ts
      - module
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        module:
          type: string
          enum:
          - urdf
        size:
          type:
          - integer
          - 'null'
          description: Total store size if available.
    HealthError:
      type: object
      required:
      - ok
      - ts
      - module
      properties:
        ok:
          type: boolean
          const: false
        ts:
          $ref: '#/components/schemas/UnixMillis'
        module:
          type: string
          enum:
          - urdf
        size:
          type:
          - integer
          - 'null'
    SizeOk:
      type: object
      required:
      - ok
      - ts
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        gid:
          type:
          - string
          - 'null'
        size:
          type: integer
          description: Size of the specified gid (present when gid query param is provided).
        totalSize:
          type: integer
          description: Total store size (present when gid query param is omitted).
    GraphOk:
      type: object
      required:
      - ok
      - ts
      - graph
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        gid:
          type:
          - string
          - 'null'
        graph:
          description: Graph contents as returned by uRDF.
          type:
          - array
          - object
          - 'null'
    NodeOk:
      type: object
      required:
      - ok
      - ts
      - id
      - node
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        id:
          type: string
        gid:
          type:
          - string
          - 'null'
        node:
          description: Found node/resource as returned by uRDF.
          type:
          - object
          - array
          - string
          - number
          - boolean
          - 'null'
    ClearRequest:
      type: object
      properties:
        gid:
          type: string
          description: If provided, clears only this named graph; otherwise clears the whole store.
      additionalProperties: false
    ClearOk:
      allOf:
      - $ref: '#/components/schemas/BasicOk'
      - type: object
        properties:
          gid:
            type: string
    JsonLdDocument:
      description: A JSON-LD document (object or array). This API does not validate the JSON-LD structure beyond JSON parsing.
      oneOf:
      - type: object
        additionalProperties: true
      - type: array
        items: {}
    LoadFileRequest:
      type: object
      required:
      - doc
      properties:
        doc:
          $ref: '#/components/schemas/JsonLdDocument'
      additionalProperties: false
      description: Replaces a named graph with the uploaded JSON-LD. The uploaded JSON-LD must include an "@id" that will be used as gid.
    LoadFromRequest:
      type: object
      required:
      - uri
      properties:
        uri:
          type: string
          format: uri
          description: URL to fetch JSON/JSON-LD from.
      additionalProperties: false
    QueryRequest:
      type: object
      required:
      - sparql
      properties:
        sparql:
          type: string
          description: SPARQL query string.
      additionalProperties: false
    QueryOk:
      type: object
      required:
      - ok
      - ts
      - type
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        type:
          type: string
          enum:
          - ASK
          - SELECT
        result:
          type: boolean
          description: ASK query result (present when type=ASK).
        results:
          type: array
          description: SELECT query results (shape depends on uRDF).
          items: {}
    LoadOk:
      type: object
      required:
      - ok
      - ts
      - size
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        size:
          type: integer
          description: Total store size after load.
    LoadFromOk:
      type: object
      required:
      - ok
      - ts
      - uri
      - totalSize
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        uri:
          type: string
          format: uri
        totalSize:
          type: integer
    LoadFileOk:
      type: object
      required:
      - ok
      - ts
      - gid
      - size
      - totalSize
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        gid:
          type: string
        size:
          type: integer
        totalSize:
          type: integer
    ExportOk:
      description: A JSON-LD export document (application/ld+json).
      $ref: '#/components/schemas/JsonLdDocument'
    RuleResource:
      type: object
      required:
      - '@id'
      - '@type'
      properties:
        '@id':
          type: string
          description: Rule identifier (IRI/URN).
        '@type':
          description: Must include the uA ontology Rule class IRI.
          oneOf:
          - type: string
          - type: array
            items:
              type: string
      additionalProperties: true
      description: A rule resource stored in the rules named graph. The runtime requires @id and that @type includes the Rule class.
    RuleCreateRequest:
      type: object
      required:
      - rule
      properties:
        rule:
          $ref: '#/components/schemas/RuleResource'
      additionalProperties: false
    RuleDeleteRequest:
      type: object
      required:
      - id
      properties:
        id:
          type: string
          description: Rule @id to delete.
      additionalProperties: false
    RuleMutateOk:
      type: object
      required:
      - ok
      - ts
      - gid
      - count
      properties:
        ok:
          type: boolean
          const: true
        ts:
          $ref: '#/components/schemas/UnixMillis'
        gid:
          type: string
        count:
          type: integer
          description: Number of rule nodes in the rules graph after the mutation.
        created:
          type: string
        updated:
          type: string
        deleted:
          type: string
        id:
          type: string
          description: Additional identifier field used in some error responses.
      additionalProperties: true
paths:
  /urdf/health:
    get:
      tags:
      - urdf
      operationId: urdfHealth
      summary: Healthcheck for uRDF module
      description: Returns whether the `urdf` module is loaded. If loaded, may also return the total store size.
      responses:
        '200':
          description: uRDF module loaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthOk'
        '500':
          description: uRDF module not loaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthError'
  /urdf/size:
    get:
      tags:
      - urdf
      operationId: urdfSize
      summary: Size of the store or a specific named graph
      parameters:
      - $ref: '#/components/parameters/GidQueryOptional'
      responses:
        '200':
          description: Size returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SizeOk'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/graph:
    get:
      tags:
      - urdf
      operationId: urdfGraph
      summary: Fetch a graph (default or named graph)
      parameters:
      - $ref: '#/components/parameters/GidQueryOptional'
      responses:
        '200':
          description: Graph returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphOk'
        '404':
          description: Graph not found (only when gid is provided)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/export:
    get:
      tags:
      - urdf
      operationId: urdfExport
      summary: Export the full store or a named graph as JSON-LD (download)
      description: Returns an `application/ld+json` document. If `gid` query param is provided, exports only that named graph.
      parameters:
      - $ref: '#/components/parameters/GidQueryOptional'
      responses:
        '200':
          description: Export document
          content:
            application/ld+json:
              schema:
                $ref: '#/components/schemas/ExportOk'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/node:
    get:
      tags:
      - urdf
      operationId: urdfNode
      summary: Fetch a single resource by id (optionally within a named graph)
      parameters:
      - $ref: '#/components/parameters/IdQueryRequired'
      - $ref: '#/components/parameters/GidQueryOptional'
      responses:
        '200':
          description: Node returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NodeOk'
        '400':
          description: 'Missing required query param: id'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: 'Node not found (heuristic: error message contains "not found")'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/clear:
    post:
      tags:
      - urdf
      operationId: urdfClear
      summary: Clear the whole store or a specific named graph
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClearRequest'
      responses:
        '200':
          description: Cleared
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClearOk'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/load:
    post:
      tags:
      - urdf
      operationId: urdfLoad
      summary: Load JSON-LD into the store (append)
      description: Loads the provided JSON-LD document into the store (does not clear existing graphs).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JsonLdDocument'
      responses:
        '200':
          description: Loaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadOk'
        '400':
          description: Invalid body (must be a JSON object or array)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/loadFrom:
    post:
      tags:
      - urdf
      operationId: urdfLoadFrom
      summary: Fetch JSON/JSON-LD from a URL and load it into the store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadFromRequest'
      responses:
        '200':
          description: Fetched and loaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadFromOk'
        '400':
          description: Missing uri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '415':
          description: Fetched content is not valid JSON or unsupported JSON shape
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '502':
          description: Upstream fetch failed (non-2xx HTTP)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/loadFile:
    post:
      tags:
      - urdf
      operationId: urdfLoadFile
      summary: Replace a named graph with an uploaded JSON-LD document
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadFileRequest'
      responses:
        '200':
          description: Replaced graph
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoadFileOk'
        '400':
          description: Invalid body or missing @id within uploaded JSON-LD
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/query:
    post:
      tags:
      - urdf
      operationId: urdfQuery
      summary: Execute a SPARQL query against the store
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
      responses:
        '200':
          description: Query executed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryOk'
        '400':
          description: Missing sparql string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '501':
          description: 'Query not implemented (heuristic: error contains "not implemented")'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/rules/create:
    post:
      tags:
      - rules
      operationId: urdfRulesCreate
      summary: Create a rule in the rules named graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RuleCreateRequest'
      responses:
        '200':
          description: Rule stored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleMutateOk'
        '400':
          description: Invalid body / missing @id / @type does not include Rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Rule not found (update only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Rule already exists (create only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/rules/update:
    post:
      tags:
      - rules
      operationId: urdfRulesUpdate
      summary: Update an existing rule in the rules named graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RuleCreateRequest'
      responses:
        '200':
          description: Rule stored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleMutateOk'
        '400':
          description: Invalid body / missing @id / @type does not include Rule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Rule not found (update only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Rule already exists (create only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /urdf/rules/delete:
    post:
      tags:
      - rules
      operationId: urdfRulesDelete
      summary: Delete a rule from the rules named graph
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RuleDeleteRequest'
      responses:
        '200':
          description: Rule deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RuleMutateOk'
        '400':
          description: Invalid body / missing id
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Rule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal error (including uRDF not loaded)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
